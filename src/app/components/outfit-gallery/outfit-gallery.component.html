<section class="section-card outfit-gallery">
  <header class="header">
    <h1>Generated outfits</h1>
  </header>

  <!-- Empty state (no outfits yet) -->
  <div class="empty" *ngIf="(generatedImages$ | async)?.length === 0">
    <mat-icon>hourglass_empty</mat-icon>
    <p>No generated outfits yet. Start by uploading a user image and choosing your garments.</p>
  </div>

  <!-- Gallery grid -->
  <div class="grid" *ngIf="(generatedImages$ | async) as images">
    <mat-card
      class="gallery-item"
      appearance="outlined"
      *ngFor="let image of images; index as i; trackBy: trackById"
    >
      <figure (click)="viewImage(image, i)" tabindex="0" role="button" aria-label="View generated outfit">
        <img *ngIf="image.status === 'ready'" [src]="image.imageUrl" alt="Generated outfit" />
        <img *ngIf="image.status !== 'ready'" src="/assets/images/outfit-loading.gif" alt="Creating outfit..." class="loading-gif" />
        <!-- Variants badge -->
        <span class="variants-badge" *ngIf="image.variantCount && image.variantCount > 1">
          <mat-icon>layers</mat-icon>
          {{ image.variantCount }}
        </span>
      </figure>
      <mat-card-content>
        <div class="meta">
          <span>{{ image.createdAt | date: 'short' }}</span>
          <span
            class="status-badge"
            [class.status-badge--ready]="image.status === 'ready'"
          >
            <mat-icon>{{ image.status === 'ready' ? 'check_circle' : 'timelapse' }}</mat-icon>
            {{ image.status === 'ready' ? 'Ready' : 'Processing' }}
          </span>
          <button
            mat-icon-button
            [matMenuTriggerFor]="imageActions"
            [matMenuTriggerData]="{ image: image, index: i }"
            aria-label="More actions"
          >
            <mat-icon>more_vert</mat-icon>
          </button>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button color="primary" (click)="viewImage(image, i)">
          Review
          <mat-icon>open_in_new</mat-icon>
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <mat-menu #imageActions="matMenu">
    <ng-template matMenuContent let-data="matMenuTriggerData">
      <button mat-menu-item (click)="viewImage(data.image, data.index)">
        <mat-icon>open_in_new</mat-icon>
        Review
      </button>
      <button mat-menu-item (click)="openEditDialog(data.image)" [disabled]="data.image.status !== 'ready'">
        <mat-icon>tune</mat-icon>
        Enhance
      </button>
      <button mat-menu-item (click)="remove(data.image)">
        <mat-icon>delete</mat-icon>
        Delete outfit
      </button>
    </ng-template>
  </mat-menu>
</section>
