<section class="section-card credits-page">
  <!-- PAGE NAVIGATION -->
  <div class="page-nav">
    <button mat-button (click)="goBack()" class="back-button">
      <mat-icon>arrow_back</mat-icon>
      Back
    </button>
  </div>

  <!-- BALANCE CARD -->
  <mat-card appearance="outlined" class="balance-card">
    <mat-card-header>
      <mat-card-title>Your Credits</mat-card-title>
      <mat-card-subtitle>Credits are used to generate outfits</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <div class="balance-display">
        <mat-icon class="balance-icon">toll</mat-icon>
        <span class="balance-value">{{ balance() ?? '...' }}</span>
        <span class="balance-label">credits available</span>
      </div>
    </mat-card-content>

    <mat-card-actions>
      <button
        mat-raised-button
        color="primary"
        routerLink="/billing"
      >
        <mat-icon>shopping_cart</mat-icon>
        Purchase Credits
      </button>
      <button
        mat-stroked-button
        (click)="grantCredits()"
        [disabled]="isGranting()"
      >
        <mat-icon>add_circle</mat-icon>
        {{ isGranting() ? 'Adding...' : 'Add 100 Credits (Demo)' }}
      </button>
    </mat-card-actions>

    <mat-progress-bar *ngIf="isGranting()" mode="indeterminate"></mat-progress-bar>
  </mat-card>

  <!-- TRANSACTION HISTORY -->
  <mat-card appearance="outlined" class="history-card">
    <mat-card-header>
      <mat-card-title>Transaction History</mat-card-title>
      <mat-card-subtitle>Recent credit activity</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <div *ngIf="isLoading()" class="loading">Loading transactions...</div>

      <div *ngIf="!isLoading() && transactions().length === 0" class="empty">
        <mat-icon>receipt_long</mat-icon>
        <p>No transactions yet. Add some credits to get started!</p>
      </div>

      <div class="table-wrapper" *ngIf="!isLoading() && transactions().length > 0">
      <table mat-table [dataSource]="transactions()" class="transactions-table">
        <!-- Date Column -->
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef>Date</th>
          <td mat-cell *matCellDef="let txn">{{ txn.createdAt | date:'short' }}</td>
        </ng-container>

        <!-- Description Column -->
        <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef>Description</th>
          <td mat-cell *matCellDef="let txn">{{ txn.description || 'Credit transaction' }}</td>
        </ng-container>

        <!-- Amount Column -->
        <ng-container matColumnDef="amount">
          <th mat-header-cell *matHeaderCellDef>Amount</th>
          <td mat-cell *matCellDef="let txn" [class.credit]="txn.amount > 0" [class.debit]="txn.amount < 0">
            {{ txn.amount > 0 ? '+' : '' }}{{ txn.amount }}
          </td>
        </ng-container>

        <!-- Balance Column -->
        <ng-container matColumnDef="balance">
          <th mat-header-cell *matHeaderCellDef>Balance</th>
          <td mat-cell *matCellDef="let txn">{{ txn.balanceAfter }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
      </div>
    </mat-card-content>
  </mat-card>
</section>
