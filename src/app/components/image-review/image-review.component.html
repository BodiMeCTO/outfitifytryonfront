<section class="section-card image-review">
  <ng-container *ngIf="image() as current">
    <figure class="preview">
      <img [src]="displayImageUrl()" alt="Selected generated outfit" />
    </figure>

    <!-- AI Disclaimer -->
    <app-ai-disclaimer variant="compact"></app-ai-disclaimer>

    <!-- Variant thumbnails (only show if there are multiple variants) -->
    <div class="variants-strip" *ngIf="hasVariants()">
      <span class="variants-label">Versions:</span>
      <div class="variants-list">
        <button
          *ngFor="let variant of current.variants; let i = index"
          class="variant-thumb"
          [class.selected]="selectedVariantIndex() === i"
          (click)="selectVariant(i)"
          [matTooltip]="getVariantLabel(variant, i)"
        >
          <img [src]="variant.imageUrl" [alt]="getVariantLabel(variant, i)" />
          <span class="variant-badge" *ngIf="variant.editType">
            <mat-icon>{{ variant.editType === 'upscaled' ? 'zoom_in' : variant.editType === 'filtered' ? 'tune' : 'auto_fix_high' }}</mat-icon>
          </span>
        </button>
      </div>
    </div>

    <!-- Input details - what was used to create this outfit -->
    <div class="input-details" *ngIf="current.modelImageUrl || current.poseName || current.backgroundName || (current.garments && current.garments.length > 0)">
      <div class="input-header">
        <mat-icon>info_outline</mat-icon>
        <span>Created with</span>
      </div>
      <div class="input-content">
        <!-- Model thumbnail -->
        <img
          *ngIf="current.modelImageUrl"
          [src]="current.modelImageUrl"
          alt="Model"
          class="input-model-thumb"
          matTooltip="Model image"
        />
        <!-- Details column -->
        <div class="input-info">
          <!-- Settings tags -->
          <div class="input-settings" *ngIf="current.poseName || current.backgroundName || current.aspectRatio">
            <span *ngIf="current.poseName" class="input-tag">
              <mat-icon>accessibility_new</mat-icon>
              {{ current.poseName }}
            </span>
            <span *ngIf="current.backgroundName" class="input-tag">
              <mat-icon>wallpaper</mat-icon>
              {{ current.backgroundName }}
            </span>
            <span *ngIf="current.aspectRatio && current.aspectRatio !== 'original'" class="input-tag">
              <mat-icon>aspect_ratio</mat-icon>
              {{ current.aspectRatio }}
            </span>
          </div>
          <!-- Garments row -->
          <div class="input-garments" *ngIf="current.garments && current.garments.length > 0">
            <img
              *ngFor="let garment of current.garments"
              [src]="garment.imageUrl"
              [alt]="garment.name"
              class="input-garment-thumb"
              [matTooltip]="garment.name + (garment.category ? ' (' + garment.category + ')' : '')"
            />
          </div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button class="nav-btn" (click)="navigate(-1)" aria-label="Previous image">
        <mat-icon>chevron_left</mat-icon>
      </button>
      <button class="nav-btn" (click)="navigate(1)" aria-label="Next image">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>

    <div class="actions">
      <button class="action-btn primary" (click)="share()">
        <mat-icon>ios_share</mat-icon>
        Share
      </button>
      <button class="action-btn" (click)="openEditDialog()">
        <mat-icon>auto_fix_high</mat-icon>
        Enhance
      </button>
      <button class="action-btn" (click)="download()">
        <mat-icon>download</mat-icon>
        Download
      </button>
      <button class="action-btn" (click)="downloadWithWatermark()" matTooltip="Download with AI-generated watermark">
        <mat-icon>verified</mat-icon>
        With Watermark
      </button>
      <button class="action-btn secondary" routerLink="/generated-gallery">
        <mat-icon>grid_view</mat-icon>
        Gallery
      </button>
    </div>
  </ng-container>
</section>
